/*---------------------------------------------------------------------------------

	Copyright (C) 2012
		Alekmaul 

	This software is provided 'as-is', without any express or implied
	warranty.  In no event will the authors be held liable for any
	damages arising from the use of this software.

	Permission is granted to anyone to use this software for any
	purpose, including commercial applications, and to alter it and
	redistribute it freely, subject to the following restrictions:

	1.	The origin of this software must not be misrepresented; you
		must not claim that you wrote the original software. If you use
		this software in a product, an acknowledgment in the product
		documentation would be appreciated but is not required.
	2.	Altered source versions must be plainly marked as such, and
		must not be misrepresented as being the original software.
	3.	This notice may not be removed or altered from any source
		distribution.

---------------------------------------------------------------------------------*/

#include <snes/dma.h>

//---------------------------------------------------------------------------------
void dmaCopyOAram(u8 *source, u16 address, u16 size) {
	dmaMemory  data_to_transfert;
	data_to_transfert.mem.p = (u8 *) source;
	
    REG_OAMADDL = 0;	// Set adress to OAM address 0 
	
	REG_DAS0LH = size; // DMA channel x transfer size  (0x220 for all sprites)
	REG_A1T0LH = data_to_transfert.mem.c.addr; // DMA channel x source address offset low $4312 and high $4313 optimisation)
	REG_A1B0 = data_to_transfert.mem.c.bank; // DMA channel x source address bank
	
    REG_DMAP0 = 0x00; // DMA channel 0 Bus B addr $2104 (OAM write) 
	REG_BBAD0 = 0x04;
	
	// Turn on DMA transfer for this channel
	REG_MDMAEN = DMA_ENABLE;
}	

//---------------------------------------------------------------------------------
void dmaCopyVram7(u8 *source, u16 address, u16 size, u8 vrammodeinc, u16 dmacontrol) {
	dmaMemory  data_to_transfert;
	data_to_transfert.mem.p = (u8 *) source;
	
	REG_VMAIN = vrammodeinc; // set address in VRam for read or write ($2116) + block size transfer ($2115)
	REG_VMADDLH = address;

	REG_DAS0LH = size; // DMA channel x transfer size  (low $4315 and high $4316 optimisation)
	REG_A1T0LH = data_to_transfert.mem.c.addr; // DMA channel x source address offset low $4312 and high $4313 optimisation)
	REG_A1B0 = data_to_transfert.mem.c.bank; // DMA channel x source address bank

	REG_DMAP0 = (dmacontrol) & 255; // set DMA control register 
	REG_BBAD0 = (dmacontrol>>8);

	REG_MDMAEN = DMA_ENABLE; // Turn on DMA transfer for this channel
}

//---------------------------------------------------------------------------------
u8 HDMATable16[32+1]= {
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

	0x00,
};

void setModeHdmaGradient(u8 maxLevels) {
	u8 i, mL = maxLevels & 15;
	
	dmaMemory  data_to_transfert;
	data_to_transfert.mem.p = (u8 *) HDMATable16;
	
	REG_HDMAEN = 0; // Disable HDMA for all channels

	for (i=0;i<32;i+=2) { // Do the shading levels
		HDMATable16[i] = 14; // because we have 224 lines and 16 steps 224/16 -> 14
		HDMATable16[i+1] = mL  - (i / (32/(mL+1)));
	}
	
    REG_DMAP3 = 0x00; // Meaning write once
	REG_BBAD3 = 0x00; // Screen display register  -> so we control brightness

	REG_A1T3LH = data_to_transfert.mem.c.addr; // DMA channel x source address offset low $4312 and high $4313 optimisation)
	REG_A1B3 = data_to_transfert.mem.c.bank; // DMA channel x source address bank

	REG_HDMAEN = 8; // Enable DMA channel 3
}

const u8 Lvl1Bright[] = 
{
    0x03,0x00,
    0x03,0x01,
    0x03,0x02,
    0x03,0x03,
    0x03,0x04,
    0x03,0x05,
    0x03,0x06,
    0x03,0x07,
    0x03,0x08,
    0x03,0x09,
    0x03,0x0A,
    0x03,0x0B,
    0x03,0x0C,
    0x03,0x0D,
    0x03,0x0E,
    0x80,0x0F,
    0x03,0x0E,
    0x03,0x0D,
    0x03,0x0C,
    0x03,0x0B,
    0x03,0x0A,
    0x03,0x09,
    0x03,0x08,
    0x03,0x07,
    0x03,0x06,
    0x03,0x05,
    0x03,0x04,
    0x03,0x03,
    0x03,0x02,
    0x03,0x01,
    0x03,0x00,
    0x00,
};

//---------------------------------------------------------------------------------
void setModeHdmaShadeUpDown(void) {
	dmaMemory  data_to_transfert;
	data_to_transfert.mem.p = (u8 *) Lvl1Bright;
	
	REG_HDMAEN = 0; // Disable HDMA

    REG_DMAP3 = 0x00; // Meaning write once
	REG_BBAD3 = 0x00; // Screen display register  -> so we control brightness

	REG_A1T3LH = data_to_transfert.mem.c.addr; // DMA channel x source address offset low $4312 and high $4313 optimisation)
	REG_A1B3 = data_to_transfert.mem.c.bank; // DMA channel x source address bank

	REG_HDMAEN = 8; // Enable DMA channel 3
}

// 134 levels per line
const u8 Lvl0Shading[]=
{
	0x02,0x3F,0x0C,0x3F,0x06,0x3F,0x07,0x3F,0x02,0x3E,0x05,0x3E,0x06,0x3E,0x09,0x3E,0x03,0x3D,0x01,0x3D,0x08,0x3D,0x06,0x3D,0x07,0x3D,0x02,0x3C,0x03,0x3C,0x07,0x3C,0x06,0x3C,0x04,0x3B,0x03,0x3B,0x07,0x3B,0x04,0x3B,0x02,0x3A,0x01,0x3A,0x01,0x3A,0x01,0x39,0x02,0x39,0x01,0x39,0x02,0x38,0x02,0x37,0x01,0x37,0x01,0x36,0x01,0x35,0x01,0x35,0x01,0x34,0x01,0x33,0x01,0x33,0x02,0x32,0x01,0x31,0x01,0x30,0x01,0x2F,0x02,0x2E,0x02,0x2D,0x01,0x2C,0x01,0x2C,0x01,0x2B,0x01,0x2B,0x01,0x2A,0x01,0x2A,0x01,0x29,0x02,0x28,0x03,0x27,0x03,0x26,0x03,0x26,0x02,0x26,0x02,0x26,0x07,0x26,0x02,0x26,0x02,0x26,0x06,0x26,0x04,0x26,0x04,0x26,0x03,0x26,0x01,0x26,0x04,0x26,0x06,0x26,0x03,0x27,0x16,0x27,
	0x02,0x5F,0x0C,0x5F,0x06,0x5F,0x07,0x5F,0x02,0x5F,0x05,0x5F,0x06,0x5F,0x09,0x5F,0x03,0x5F,0x01,0x5F,0x08,0x5F,0x06,0x5F,0x07,0x5F,0x02,0x5F,0x03,0x5F,0x07,0x5F,0x06,0x5F,0x04,0x5F,0x03,0x5F,0x07,0x5F,0x04,0x5F,0x02,0x5F,0x01,0x5F,0x01,0x5F,0x01,0x5F,0x02,0x5F,0x01,0x5F,0x02,0x5F,0x02,0x5F,0x01,0x5F,0x01,0x5F,0x01,0x5F,0x01,0x5E,0x01,0x5E,0x01,0x5E,0x01,0x5D,0x02,0x5C,0x01,0x5C,0x01,0x5B,0x01,0x5A,0x02,0x59,0x02,0x58,0x01,0x58,0x01,0x57,0x01,0x57,0x01,0x56,0x01,0x56,0x01,0x55,0x01,0x55,0x02,0x54,0x03,0x54,0x03,0x54,0x03,0x54,0x02,0x55,0x02,0x55,0x07,0x56,0x02,0x56,0x02,0x57,0x06,0x58,0x04,0x59,0x04,0x59,0x03,0x59,0x01,0x5A,0x04,0x5A,0x06,0x5B,0x03,0x5B,0x16,0x5B,
	0x02,0x9F,0x0C,0x9E,0x06,0x9D,0x07,0x9C,0x02,0x9C,0x05,0x9B,0x06,0x9A,0x09,0x99,0x03,0x99,0x01,0x98,0x08,0x97,0x06,0x96,0x07,0x95,0x02,0x95,0x03,0x94,0x07,0x93,0x06,0x92,0x04,0x92,0x03,0x91,0x07,0x90,0x04,0x8F,0x02,0x8E,0x01,0x8D,0x01,0x8C,0x01,0x8C,0x02,0x8B,0x01,0x8A,0x02,0x89,0x02,0x88,0x01,0x87,0x01,0x87,0x01,0x87,0x01,0x87,0x01,0x86,0x01,0x86,0x01,0x86,0x02,0x86,0x01,0x86,0x01,0x86,0x01,0x86,0x02,0x86,0x02,0x86,0x01,0x86,0x01,0x86,0x01,0x86,0x01,0x86,0x01,0x86,0x01,0x86,0x01,0x86,0x02,0x86,0x03,0x86,0x03,0x86,0x03,0x87,0x02,0x87,0x02,0x88,0x07,0x88,0x02,0x89,0x02,0x89,0x06,0x89,0x04,0x89,0x04,0x88,0x03,0x87,0x01,0x87,0x04,0x86,0x06,0x86,0x03,0x86,0x16,0x86,
};

const u8 Lvl1Shading[]=
{
	0x02,0x3F,0x0C,0x3E,0x02,0x3E,0x04,0x3D,0x04,0x3D,0x03,0x3C,0x06,0x3C,0x01,0x3B,0x06,0x3A,0x02,0x3A,0x07,0x39,0x06,0x38,0x01,0x38,0x05,0x37,0x05,0x37,0x03,0x36,0x05,0x35,0x05,0x34,0x07,0x33,0x01,0x33,0x05,0x32,0x04,0x32,0x03,0x31,0x07,0x30,0x04,0x2F,0x02,0x2E,0x01,0x2D,0x01,0x2C,0x03,0x2B,0x01,0x2A,0x01,0x2A,0x01,0x29,0x02,0x28,0x01,0x27,0x01,0x27,0x01,0x27,0x01,0x27,0x01,0x26,0x01,0x26,0x01,0x26,0x02,0x26,0x02,0x26,0x01,0x26,0x01,0x26,0x01,0x26,0x01,0x26,0x01,0x26,0x02,0x26,0x02,0x26,0x01,0x26,0x01,0x26,0x03,0x26,0x01,0x26,0x03,0x26,0x03,0x26,0x02,0x26,0x02,0x26,0x02,0x26,0x02,0x26,0x01,0x26,0x04,0x26,0x04,0x26,0x04,0x26,0x02,0x26,0x04,0x26,0x01,0x26,0x03,0x26,0x04,0x26,0x04,0x26,0x06,0x26,0x19,0x26,0x00,
	0x02,0x5F,0x0C,0x5F,0x02,0x5F,0x04,0x5F,0x04,0x5F,0x03,0x5F,0x06,0x5F,0x01,0x5F,0x06,0x5F,0x02,0x5F,0x07,0x5F,0x06,0x5F,0x01,0x5F,0x05,0x5F,0x05,0x5F,0x03,0x5F,0x05,0x5F,0x05,0x5F,0x07,0x5F,0x01,0x5F,0x05,0x5F,0x04,0x5F,0x03,0x5F,0x07,0x5F,0x04,0x5F,0x02,0x5F,0x01,0x5F,0x01,0x5F,0x03,0x5F,0x01,0x5F,0x01,0x5F,0x01,0x5F,0x02,0x5F,0x01,0x5F,0x01,0x5F,0x01,0x5F,0x01,0x5E,0x01,0x5E,0x01,0x5E,0x01,0x5D,0x02,0x5C,0x02,0x5B,0x01,0x5A,0x01,0x5A,0x01,0x59,0x01,0x59,0x01,0x58,0x02,0x57,0x02,0x56,0x01,0x56,0x01,0x55,0x03,0x54,0x01,0x54,0x03,0x54,0x03,0x54,0x02,0x54,0x02,0x55,0x02,0x55,0x02,0x54,0x01,0x55,0x04,0x55,0x04,0x55,0x04,0x56,0x02,0x57,0x04,0x57,0x01,0x58,0x03,0x59,0x04,0x5A,0x04,0x5A,0x06,0x5B,0x19,0x5B,0x00,
	0x02,0x9F,0x0C,0x9F,0x02,0x9E,0x04,0x9E,0x04,0x9D,0x03,0x9D,0x06,0x9C,0x01,0x9C,0x06,0x9C,0x02,0x9B,0x07,0x9A,0x06,0x9A,0x01,0x99,0x05,0x99,0x05,0x98,0x03,0x98,0x05,0x97,0x05,0x96,0x07,0x96,0x01,0x95,0x05,0x95,0x04,0x94,0x03,0x94,0x07,0x93,0x04,0x92,0x02,0x91,0x01,0x91,0x01,0x90,0x03,0x8F,0x01,0x8F,0x01,0x8E,0x01,0x8E,0x02,0x8E,0x01,0x8E,0x01,0x8D,0x01,0x8E,0x01,0x8D,0x01,0x8D,0x01,0x8E,0x01,0x8D,0x02,0x8E,0x02,0x8E,0x01,0x8E,0x01,0x8F,0x01,0x8E,0x01,0x8F,0x01,0x8F,0x02,0x8F,0x02,0x8F,0x01,0x90,0x01,0x90,0x03,0x90,0x01,0x91,0x03,0x92,0x03,0x93,0x02,0x94,0x02,0x94,0x02,0x95,0x02,0x95,0x01,0x95,0x04,0x96,0x04,0x97,0x04,0x97,0x02,0x98,0x04,0x99,0x01,0x99,0x03,0x99,0x04,0x99,0x04,0x98,0x06,0x98,0x19,0x98,0x00,
};
/* 
hdmaGradient2List0:
 .db $02,$3F,$0C,$3E,$06,$3D,$07,$3C,$07,$3B,$06,$3A,$09,$39,$04,$38,$08,$37,$06,$36,$07,$35,$05,$34,$07,$33,$06,$32,$07,$31,$07,$30,$04,$2F,$02,$2E,$01,$2D,$01,$2C,$01,$2C,$02,$2B,$01,$2A,$02,$29,$02,$28,$01,$27,$01,$26,$01,$26,$02,$25,$01,$24,$02,$23,$02,$22,$01,$21,$01,$21,$01,$20,$02,$20,$01,$20,$01,$20,$02,$20,$01,$20,$01,$20,$01,$20,$01,$20,$01,$20,$01,$20,$02,$20,$01,$20,$01,$20,$02,$20,$01,$20,$02,$20,$02,$20,$02,$20,$04,$20,$02,$20,$04,$20,$05,$20,$06,$20,$04,$20,$01,$20,$02,$20,$04,$20,$01,$20,$04,$21,$02,$21,$04,$21,$15,$21
hdmaGradient2List1:
 .db $02,$5F,$0C,$5F,$06,$5F,$07,$5F,$07,$5F,$06,$5F,$09,$5F,$04,$5F,$08,$5F,$06,$5F,$07,$5F,$05,$5F,$07,$5F,$06,$5F,$07,$5F,$07,$5F,$04,$5F,$02,$5F,$01,$5F,$01,$5F,$01,$5E,$02,$5E,$01,$5E,$02,$5E,$02,$5D,$01,$5D,$01,$5D,$01,$5C,$02,$5B,$01,$5B,$02,$5A,$02,$59,$01,$58,$01,$57,$01,$56,$02,$55,$01,$54,$01,$52,$02,$51,$01,$50,$01,$4F,$01,$4E,$01,$4D,$01,$4C,$01,$4B,$02,$4A,$01,$49,$01,$48,$02,$47,$01,$46,$02,$45,$02,$44,$02,$43,$04,$43,$02,$42,$04,$42,$05,$42,$06,$43,$04,$44,$01,$45,$02,$46,$04,$47,$01,$48,$04,$49,$02,$4A,$04,$4B,$15,$4B
hdmaGradient2List2:
 .db $02,$9F,$0C,$9F,$06,$9F,$07,$9F,$07,$9F,$06,$9F,$09,$9F,$04,$9F,$08,$9F,$06,$9F,$07,$9F,$05,$9F,$07,$9F,$06,$9F,$07,$9F,$07,$9F,$04,$9F,$02,$9F,$01,$9F,$01,$9F,$01,$9F,$02,$9F,$01,$9F,$02,$9F,$02,$9F,$01,$9F,$01,$9F,$01,$9F,$02,$9F,$01,$9F,$02,$9F,$02,$9F,$01,$9F,$01,$9F,$01,$9F,$02,$9F,$01,$9E,$01,$9E,$02,$9D,$01,$9C,$01,$9C,$01,$9C,$01,$9C,$01,$9B,$01,$9B,$02,$9A,$01,$9A,$01,$9A,$02,$9A,$01,$9A,$02,$9B,$02,$9B,$02,$9B,$04,$9C,$02,$9C,$04,$9D,$05,$9E,$06,$9F,$04,$9F,$01,$9F,$02,$9F,$04,$9F,$01,$9F,$04,$9F,$02,$9F,$04,$9F,$15,$9F

hdmaGradient3List0:
 .db $02,$3F,$4E,$3F,$01,$3F,$02,$3F,$01,$3F,$01,$3F,$03,$3F,$01,$3F,$01,$3F,$01,$3F,$01,$3F,$02,$3F,$02,$3F,$02,$3F,$01,$3F,$01,$3F,$02,$3F,$02,$3F,$02,$3F,$02,$3F,$01,$3F,$01,$3F,$02,$3F,$02,$3F,$01,$3F,$01,$3F,$02,$3F,$02,$3F,$03,$3F,$01,$3E,$01,$3E,$01,$3D,$02,$3C,$02,$3B,$01,$3B,$01,$3B,$01,$3A,$01,$3A,$01,$39,$01,$39,$01,$38,$01,$37,$03,$36,$02,$35,$01,$34,$03,$33,$02,$32,$02,$31,$02,$30,$02,$2F,$02,$2E,$01,$2E,$01,$2D,$02,$2C,$03,$2B,$02,$2A,$01,$29,$03,$28,$01,$27,$02,$26,$02,$26,$01,$25,$01,$24,$03,$23,$03,$22,$01,$21,$01,$21,$01,$20,$26,$20
hdmaGradient3List1:
 .db $02,$5D,$4E,$5D,$01,$5C,$02,$5D,$01,$5C,$01,$5C,$03,$5C,$01,$5B,$01,$5B,$01,$5C,$01,$5B,$02,$5B,$02,$5B,$02,$5A,$01,$5B,$01,$5A,$02,$5A,$02,$5A,$02,$59,$02,$5A,$01,$59,$01,$59,$02,$59,$02,$59,$01,$58,$01,$58,$02,$58,$02,$58,$03,$57,$01,$57,$01,$56,$01,$56,$02,$55,$02,$54,$01,$55,$01,$54,$01,$54,$01,$53,$01,$53,$01,$52,$01,$53,$01,$51,$03,$50,$02,$50,$01,$4F,$03,$4E,$02,$4E,$02,$4D,$02,$4C,$02,$4B,$02,$4B,$01,$4A,$01,$4A,$02,$49,$03,$48,$02,$47,$01,$47,$03,$46,$01,$45,$02,$45,$02,$44,$01,$44,$01,$43,$03,$42,$03,$41,$01,$41,$01,$40,$01,$40,$26,$40
hdmaGradient3List2:
 .db $02,$95,$4E,$94,$01,$93,$02,$93,$01,$92,$01,$91,$03,$90,$01,$90,$01,$8F,$01,$8F,$01,$8E,$02,$8D,$02,$8C,$02,$8B,$01,$8B,$01,$8A,$02,$89,$02,$88,$02,$87,$02,$86,$01,$86,$01,$85,$02,$84,$02,$83,$01,$83,$01,$82,$02,$81,$02,$80,$03,$80,$01,$80,$01,$80,$01,$80,$02,$80,$02,$80,$01,$80,$01,$80,$01,$80,$01,$80,$01,$80,$01,$80,$01,$80,$01,$80,$03,$80,$02,$80,$01,$80,$03,$80,$02,$80,$02,$80,$02,$80,$02,$80,$02,$80,$01,$80,$01,$80,$02,$80,$03,$80,$02,$80,$01,$80,$03,$80,$01,$80,$02,$80,$02,$80,$01,$80,$01,$80,$03,$80,$03,$80,$01,$80,$01,$80,$01,$80,$26,$80

hdmaGradient4List0:
 .db $02,$37,$4D,$36,$02,$35,$03,$34,$01,$33,$03,$32,$01,$31,$02,$30,$01,$30,$01,$2F,$02,$2E,$02,$2D,$02,$2C,$02,$2B,$02,$2A,$02,$29,$02,$28,$01,$28,$01,$27,$02,$26,$01,$26,$01,$25,$01,$25,$01,$24,$02,$23,$01,$22,$02,$22,$01,$21,$01,$21,$01,$20,$01,$20,$03,$20,$01,$20,$01,$20,$02,$20,$02,$20,$02,$20,$01,$20,$01,$20,$01,$20,$02,$20,$01,$20,$02,$20,$01,$20,$03,$20,$01,$20,$03,$20,$02,$20,$02,$20,$01,$20,$01,$20,$01,$20,$01,$20,$02,$20,$02,$20,$02,$20,$02,$20,$02,$20,$02,$20,$01,$20,$01,$20,$02,$20,$01,$20,$02,$20,$02,$20,$03,$20,$01,$20,$03,$20,$25,$20
hdmaGradient4List1:
 .db $02,$5B,$4D,$5B,$02,$5A,$03,$59,$01,$59,$03,$58,$01,$58,$02,$57,$01,$58,$01,$57,$02,$57,$02,$56,$02,$55,$02,$55,$02,$55,$02,$54,$02,$54,$01,$53,$01,$53,$02,$53,$01,$52,$01,$52,$01,$51,$01,$52,$02,$51,$01,$51,$02,$50,$01,$4F,$01,$50,$01,$50,$01,$4F,$03,$4F,$01,$4E,$01,$4E,$02,$4D,$02,$4D,$02,$4D,$01,$4C,$01,$4C,$01,$4C,$02,$4B,$01,$4B,$02,$4B,$01,$4A,$03,$4A,$01,$49,$03,$48,$02,$48,$02,$48,$01,$47,$01,$47,$01,$47,$01,$46,$02,$46,$02,$45,$02,$45,$02,$45,$02,$44,$02,$44,$01,$43,$01,$43,$02,$43,$01,$42,$02,$42,$02,$41,$03,$41,$01,$40,$03,$40,$25,$40
hdmaGradient4List2:
 .db $02,$9F,$4D,$9F,$02,$9F,$03,$9F,$01,$9F,$03,$9F,$01,$9F,$02,$9F,$01,$9F,$01,$9F,$02,$9F,$02,$9F,$02,$9F,$02,$9F,$02,$9F,$02,$9F,$02,$9F,$01,$9F,$01,$9F,$02,$9F,$01,$9F,$01,$9F,$01,$9F,$01,$9F,$02,$9F,$01,$9F,$02,$9F,$01,$9F,$01,$9F,$01,$9F,$01,$9F,$03,$9E,$01,$9E,$01,$9D,$02,$9C,$02,$9B,$02,$9A,$01,$9A,$01,$99,$01,$98,$02,$98,$01,$97,$02,$96,$01,$95,$03,$94,$01,$93,$03,$92,$02,$91,$02,$90,$01,$90,$01,$8F,$01,$8E,$01,$8E,$02,$8D,$02,$8C,$02,$8B,$02,$8A,$02,$89,$02,$88,$01,$88,$01,$87,$02,$86,$01,$85,$02,$84,$02,$83,$03,$82,$01,$81,$03,$80,$25,$80

const unsigned char* const hdmaTables[6][3]=
{
{ hdmaTableNull,hdmaTableNull,hdmaTableNull },
{ hdmaGradient0List0,hdmaGradient0List1,hdmaGradient0List2 },
{ hdmaGradient2List0,hdmaGradient2List1,hdmaGradient2List2 },
{ hdmaGradient1List0,hdmaGradient1List1,hdmaGradient1List2 },
{ hdmaGradient3List0,hdmaGradient3List1,hdmaGradient3List2 },
{ hdmaGradient4List0,hdmaGradient4List1,hdmaGradient4List2 }
};
const u8 Lvl3Sh[]=
{
	0x4F,0x21,0x04,0x22,0x04,0x24,0x04,0x25,0x04,0x27,0x04,0x28,0x04,0x2A,0x04,0x2B,0x04,0x2D,0x04,0x2E,0x04,0x30,0x00

LVL1GREEN:
db $4F,$50
db $04,$51
db $04,$52
db $04,$53
db $04,$54
db $04,$55
db $04,$56
db $04,$57
db $04,$58
db $04,$59
db $04,$5A
db $00

LVL1BLUE:
db $4F,$99
db $08,$9A
db $08,$9B
db $08,$9D
db $08,$9E
db $08,$9F
db $00
*/

//---------------------------------------------------------------------------------
void setModeHdmaShading(unsigned char mode) {
	dmaMemory  data_to_transfert;
	
	WaitForVBlank();
	REG_HDMAEN = 0; // Disable HDMA
	WaitForVBlank();

	if (mode == 0) return; // So we only stop shading
	
	REG_DMAP0 = 0x00;
	REG_BBAD0 = 0x32; // Screen display register  -> so we control brightness
	data_to_transfert.mem.p = (u8 *) Lvl1Shading;
	REG_A1T0LH = data_to_transfert.mem.c.addr; // DMA channel x source address offset low $4312 and high $4313 optimisation)
	REG_A1B0 = data_to_transfert.mem.c.bank; // DMA channel x source address bank
	REG_DMAP1 = 0x00;
	REG_BBAD1 = 0x32; // Screen display register  -> so we control brightness
	data_to_transfert.mem.p = (u8 *) (Lvl1Shading+143);
	REG_A1T1LH = data_to_transfert.mem.c.addr; // DMA channel x source address offset low $4312 and high $4313 optimisation)
	REG_A1B1 = data_to_transfert.mem.c.bank; // DMA channel x source address bank
	REG_DMAP2 = 0x00;
	REG_BBAD2 = 0x32; // Screen display register  -> so we control brightness
	data_to_transfert.mem.p = (u8 *) (Lvl1Shading+285);
	REG_A1T2LH = data_to_transfert.mem.c.addr; // DMA channel x source address offset low $4312 and high $4313 optimisation)
	REG_A1B2 = data_to_transfert.mem.c.bank; // DMA channel x source address bank

	REG_HDMAEN = 7; // Enable DMA channel 1..3
}

//--for pseudo3D effect
const u8 HScl[] = 
{
    0x71 , 0xAA,0x01, 0x01 , 0xA5,0x01, // 72
    0x01 , 0xA0,0x01, 0x01 , 0x9B,0x01,
    0x01 , 0x96,0x01, 0x01 , 0x91,0x01,
    0x01 , 0x8C,0x01, 0x01 , 0x87,0x01,
    0x01 , 0x82,0x01, 0x01 , 0x7D,0x01,
    0x01 , 0x78,0x01, 0x01 , 0x73,0x01,
    0x01 , 0x6E,0x01, 0x01 , 0x69,0x01,
    0x01 , 0x64,0x01, 0x01 , 0x5F,0x01,
    0x01 , 0x5A,0x01, 0x01 , 0x55,0x01, // 82
    0x01 , 0x50,0x01, 0x01 , 0x4B,0x01,
    0x01 , 0x46,0x01, 0x01 , 0x41,0x01,
    0x01 , 0x3C,0x01, 0x01 , 0x37,0x01,
    0x01 , 0x32,0x01, 0x01 , 0x2D,0x01,
    0x01 , 0x28,0x01, 0x01 , 0x24,0x01,
    0x01 , 0x20,0x01, 0x01 , 0x1C,0x01,
    0x01 , 0x18,0x01, 0x01 , 0x14,0x01,
    0x01 , 0x10,0x01, 0x01 , 0x0C,0x01, // 92
    0x01 , 0x09,0x01, 0x01 , 0x06,0x01,
    0x01 , 0x03,0x01, 0x01 , 0x00,0x01,
    
	0x01 , 0xFD,0x00 , 0x01 , 0xFA,0x00,
    0x01 , 0xF7,0x00 , 0x01 , 0xF4,0x00,
    0x01 , 0xF1,0x00 , 0x01 , 0xEE,0x00,
    0x01 , 0xEB,0x00 , 0x01 , 0xE8,0x00,
    0x01 , 0xE6,0x00 , 0x01 , 0xE4,0x00,
    0x01 , 0xE2,0x00 , 0x01 , 0xE1,0x00, // A2
    0x01 , 0xE0,0x00 , 0x01 , 0xDF,0x00,
    0x01 , 0xDE,0x00 , 0x01 , 0xDD,0x00,
    0x01 , 0xDC,0x00 , 0x01 , 0xDB,0x00,
    0x01 , 0xDA,0x00 , 0x01 , 0xD9,0x00,
    0x01 , 0xD8,0x00 , 0x01 , 0xD7,0x00,
    0x01 , 0xD6,0x00 , 0x01 , 0xD5,0x00,
    0x01 , 0xD4,0x00 , 0x01 , 0xD3,0x00,
    0x01 , 0xD2,0x00 , 0x01 , 0xD1,0x00, // B2
    0x01 , 0xD0,0x00 , 0x01 , 0xCF,0x00,
    0x01 , 0xCE,0x00 , 0x01 , 0xCD,0x00,
    0x01 , 0xCC,0x00 , 0x01 , 0xCB,0x00,
    0x01 , 0xCA,0x00 , 0x01 , 0xC9,0x00,
    0x01 , 0xC8,0x00 , 0x01 , 0xC7,0x00,
    0x01 , 0xC6,0x00 , 0x01 , 0xC5,0x00,
    0x01 , 0xC4,0x00 , 0x01 , 0xC3,0x00,
    0x01 , 0xC2,0x00 , 0x01 , 0xC1,0x00, // C2
    0x01 , 0xC0,0x00 , 0x01 , 0xBF,0x00,
    0x01 , 0xBE,0x00 , 0x01 , 0xBD,0x00,
    0x01 , 0xBC,0x00 , 0x01 , 0xBB,0x00,
    0x01 , 0xBA,0x00 , 0x01 , 0xB9,0x00,
    0x01 , 0xB8,0x00 , 0x01 , 0xB7,0x00,
    0x01 , 0xB6,0x00 , 0x01 , 0xB5,0x00,
    0x01 , 0xB4,0x00 , 0x01 , 0xB3,0x00,
    0x01 , 0xB2,0x00 , 0x01 , 0xB1,0x00, // D2
    0x01 , 0xB0,0x00 , 0x01 , 0xAF,0x00,
    0x01 , 0xAE,0x00 , 0x01 , 0xAD,0x00,
    0x01 , 0xAC,0x00 , 0x01 , 0xAB,0x00,
    0x01 , 0xAA,0x00 , 0x01 , 0xA9,0x00,
    0x01 , 0xA8,0x00 , 0x01 , 0xA7,0x00,
    0x01 , 0xA6,0x00 , 0x01 , 0xA5,0x00,
    0x01 , 0xA4,0x00 , 0x01 , 0xA3,0x00, // E0


/*
    0x71 , 0x01,0xAA, 0x01 , 0x01,0xA5, // 72
    0x01 , 0x01,0xA0, 0x01 , 0x01,0x9B,
    0x01 , 0x01,0x96, 0x01 , 0x01,0x91,
    0x01 , 0x01,0x8C, 0x01 , 0x01,0x87,
    0x01 , 0x01,0x82, 0x01 , 0x01,0x7D,
    0x01 , 0x01,0x78, 0x01 , 0x01,0x73,
    0x01 , 0x01,0x6E, 0x01 , 0x01,0x69,
    0x01 , 0x01,0x64, 0x01 , 0x01,0x5F,
    0x01 , 0x01,0x5A, 0x01 , 0x01,0x55, // 82
    0x01 , 0x01,0x50, 0x01 , 0x01,0x4B,
    0x01 , 0x01,0x46, 0x01 , 0x01,0x41,
    0x01 , 0x01,0x3C, 0x01 , 0x01,0x37,
    0x01 , 0x01,0x32, 0x01 , 0x01,0x2D,
    0x01 , 0x01,0x28, 0x01 , 0x01,0x24,
    0x01 , 0x01,0x20, 0x01 , 0x01,0x1C,
    0x01 , 0x01,0x18, 0x01 , 0x01,0x14,
    0x01 , 0x01,0x10, 0x01 , 0x01,0x0C, // 92
    0x01 , 0x01,0x09, 0x01 , 0x01,0x06,
    0x01 , 0x01,0x03, 0x01 , 0x01,0x00,
    
	0x01 , 0x00,0xFD, 0x01 , 0x00,0xFA,
    0x01 , 0x00,0xF7, 0x01 , 0x00,0xF4,
    0x01 , 0x00,0xF1, 0x01 , 0x00,0xEE,
    0x01 , 0x00,0xEB, 0x01 , 0x00,0xE8,
    0x01 , 0x00,0xE6, 0x01 , 0x00,0xE4,
    0x01 , 0x00,0xE2, 0x01 , 0x00,0xE1, // A2
    0x01 , 0x00,0xE0, 0x01 , 0x00,0xDF,
    0x01 , 0x00,0xDE, 0x01 , 0x00,0xDD,
    0x01 , 0x00,0xDC, 0x01 , 0x00,0xDB,
    0x01 , 0x00,0xDA, 0x01 , 0x00,0xD9,
    0x01 , 0x00,0xD8, 0x01 , 0x00,0xD7,
    0x01 , 0x00,0xD6, 0x01 , 0x00,0xD5,
    0x01 , 0x00,0xD4, 0x01 , 0x00,0xD3,
    0x01 , 0x00,0xD2, 0x01 , 0x00,0xD1, // B2
    0x01 , 0x00,0xD0, 0x01 , 0x00,0xCF,
    0x01 , 0x00,0xCE, 0x01 , 0x00,0xCD,
    0x01 , 0x00,0xCC, 0x01 , 0x00,0xCB,
    0x01 , 0x00,0xCA, 0x01 , 0x00,0xC9,
    0x01 , 0x00,0xC8, 0x01 , 0x00,0xC7,
    0x01 , 0x00,0xC6, 0x01 , 0x00,0xC5,
    0x01 , 0x00,0xC4, 0x01 , 0x00,0xC3,
    0x01 , 0x00,0xC2, 0x01 , 0x00,0xC1, // C2
    0x01 , 0x00,0xC0, 0x01 , 0x00,0xBF,
    0x01 , 0x00,0xBE, 0x01 , 0x00,0xBD,
    0x01 , 0x00,0xBC, 0x01 , 0x00,0xBB,
    0x01 , 0x00,0xBA, 0x01 , 0x00,0xB9,
    0x01 , 0x00,0xB8, 0x01 , 0x00,0xB7,
    0x01 , 0x00,0xB6, 0x01 , 0x00,0xB5,
    0x01 , 0x00,0xB4, 0x01 , 0x00,0xB3,
    0x01 , 0x00,0xB2, 0x01 , 0x00,0xB1, // D2
    0x01 , 0x00,0xB0, 0x01 , 0x00,0xAF,
    0x01 , 0x00,0xAE, 0x01 , 0x00,0xAD,
    0x01 , 0x00,0xAC, 0x01 , 0x00,0xAB,
    0x01 , 0x00,0xAA, 0x01 , 0x00,0xA9,
    0x01 , 0x00,0xA8, 0x01 , 0x00,0xA7,
    0x01 , 0x00,0xA6, 0x01 , 0x00,0xA5,
    0x01 , 0x00,0xA4, 0x01 , 0x00,0xA3, // E0
*/
    0x00
};

//---------------------------------------------------------------------------------
void setModeHdma3D(void) {
	dmaMemory  data_to_transfert;
	data_to_transfert.mem.p = (u8 *) HScl;

	REG_HDMAEN = 0; // Disable HDMA
	
    REG_DMAP3 = 0x02; // 1 register write twice
	REG_BBAD3 = 0x1B; // Rotation/Scaling Parameter A 

    REG_DMAP4 = 0x02; // 1 register write twice
	REG_BBAD4 = 0x1E; // Rotation/Scaling Parameter D 

	REG_A1T3LH = data_to_transfert.mem.c.addr; // DMA channel x source address offset low $4312 and high $4313 optimisation)
	REG_A1B3 = data_to_transfert.mem.c.bank; // DMA channel x source address bank

	REG_A1T4LH = data_to_transfert.mem.c.addr; // DMA channel x source address offset low $4312 and high $4313 optimisation)
	REG_A1B4 = data_to_transfert.mem.c.bank; // DMA channel x source address bank

	REG_HDMAEN = (DMA_ENABLE<<3) | (DMA_ENABLE<<4); // Enable DMA channel 3 & 4
}
